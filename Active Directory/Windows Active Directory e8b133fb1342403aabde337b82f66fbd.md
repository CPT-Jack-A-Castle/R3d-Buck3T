# Windows Active Directory

# Active Directory Pentesting Methodology

> Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
> 

# Table of Contents:

- [Domain Enumeration (Users, Groups, Computers, GPOs)](about:blank#domain-enumeration-users-groups-computers-gpos)
- [ACLs Enumeration](about:blank#access-controls-enumeration-acls)
- Enumerating AD Trusts -
- Abusing Kerberos
    - AS-REPRoasting
    - Kerberoasting
- Abusing Kerberos Authentication & Delegation
    - Unconstrained Delegation
    - Constrained Delegation
    - Resource-based Constrained Delegation
- Abusing ACLs Misconfigurations -
- Abuse Active Directory Domain Trusts

### Domain Enumeration (Users, Groups, Computers, GPOs)

> Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
> 

üõ†Ô∏è **Enumeration Tools**: 

- PowerView
- SharpView
- GPResults - *built-in*

üíª **Enumeration Commands**

- [AD Enumeration (Users, Groups, Computers, GPOs](https://medium.com/r3d-buck3t)

üìö **Resources** 

- [Domain Enumeration with PowerShell Active Directory Module](https://medium.com/r3d-buck3t/domain-enumeration-with-active-directory-powershell-module-7ce4fcfe91d3) (R3d-Buck3T Blog)
- Article #2

- üí° Quick Notes
    
    üîπ test
    
    üîπ test
    
    üîπ test
    
    üîπ test
    

### Access Controls Enumeration (ACLs)

> Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
> 

üõ†Ô∏è **Enumeration Tools**: 

- PowerView
- SharpView
- GPResults *built-in*

üíª **Enumeration Commands**

- [AD Enumeration (Users, Groups, Computers, GPOs](https://medium.com/r3d-buck3t)

üìö **Resources** 

- [Domain Enumeration with PowerShell Active Directory Module](https://medium.com/r3d-buck3t/domain-enumeration-with-active-directory-powershell-module-7ce4fcfe91d3)
- Article #2
- A

- üí° Quick Notes
    
    üîπ test
    
    üîπ test
    
    üîπ test
    
    üîπ test
    

### Enumerating AD Trusts

> Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
> 

üõ†Ô∏è **Enumeration Tools**: 

- PowerView
- SharpView
- GPResults *built-in*

üíª **Enumeration Commands**

- [AD Enumeration (Users, Groups, Computers, GPOs](https://medium.com/r3d-buck3t)

üìö **Resources** 

- [Domain Enumeration with PowerShell Active Directory Module](https://medium.com/r3d-buck3t/domain-enumeration-with-active-directory-powershell-module-7ce4fcfe91d3)
- Article #2
- A

- üí° Quick Notes

# Training Resources

- Hack The Box Academy
    - Active Directory Enumeration with PowerView
    - 
- Pentester Academy - Certified Red Team Professional Training
- Ignite Technologies - Active Directory Training
- CertCube - Advanced Active Directory Training
- Red Team - Black Hills Information Security (BHIS)

### Related Certifications:

- CRTP
- OSCP (New version with AD)
- CRTO

---

## Active Directory Attacks

[Understanding Kerberos ](https://www.notion.so/Understanding-Kerberos-8111c7d355a3403eac937f7a2f8edfaf)

[AS-REP Roasting Attack ](https://www.notion.so/AS-REP-Roasting-Attack-44559794040f4116b29c6bdd21021e50)

[Kerberoasting Service Accounts](https://www.notion.so/Kerberoasting-Service-Accounts-8cff124c6fdd4f3eabedb047fb63fe04)

# Service Enumeration

---

[Port DNS - 53](https://www.notion.so/Port-DNS-53-a3eea78622b24434a6fc02f903f3a117)

[Port 161 SNMP](https://www.notion.so/Port-161-SNMP-29561075758046d4b8ef67172d402a37)

[Port  RPC -135](https://www.notion.so/Port-RPC-135-46674c158b9e43bfa29b6ae8b8320d50)

[Port 139 - NetBios](https://www.notion.so/Port-139-NetBios-878ce86a5dfa416bb95f949a5ffd3397)

[LDAP 389 & 3268](https://www.notion.so/LDAP-389-3268-49b266e60469445b806f9649ee31961d)

[Port 445 - SMB](https://www.notion.so/Port-445-SMB-eee6a1cb09cb474faa0728537fcd909a)

[Port 3389 - RDP](https://www.notion.so/Port-3389-RDP-df496eafe15940e18402cd5be63f1a78)

[Port 5800 - WinRM](https://www.notion.so/Port-5800-WinRM-688c59f3eeef4cff8e921cbb8c13dae2)

[Port 4700 - WinRM](https://www.notion.so/Port-4700-WinRM-b35ea39d618643abbc5b35b824cf1906)

# Command Sheets

---

[**Active Directory Attack Methodology** ](https://www.notion.so/Active-Directory-Attack-Methodology-2ca1e61c714542fb9830860eb25160a7)

[PowerShell](https://www.notion.so/PowerShell-f85e5aa9932744f6970b079e2fa111c4)

[AD - Objectives](https://www.notion.so/AD-Objectives-4069f2c5e06d46d695ad3e383589df24)

[Active Directory Modules- HTB](https://www.notion.so/Active-Directory-Modules-HTB-358bcd9a44ae4595b6ffc7de4f143221)

[Enumeration with PowerView - HTB](https://www.notion.so/Enumeration-with-PowerView-HTB-1ce2d372021748faacbfa046a44f52be)

### Password Spray

---

[Windows Username Conventions](https://www.notion.so/Windows-Username-Conventions-cd6bc2fd91ba411c95f7916b782e6a87)

## Tools

---

[**Bloodhound**](https://www.notion.so/Bloodhound-70800a8f5c384b23834455830fd70c5e)

# Post-Exploitation

## Enumeration

**Manual Enumeration with PowerShell**

[Manual Enumeration](https://www.notion.so/Manual-Enumeration-6e0177db13c248d0b60763713ee8e7a1)

[Bypassing Microsoft AMSI](https://www.notion.so/Bypassing-Microsoft-AMSI-6e4d875ba44b4512b768af4a98d100f0)

**Enumerating Users, Groups, Computers, Group Policies** 

[Domain Enumeration with PowerShell Active Directory Module](https://www.notion.so/Domain-Enumeration-with-PowerShell-Active-Directory-Module-a6d901bd09ce46f9a4be4bcb85b9d6df)

[Domain Enumeration with PowerView](https://www.notion.so/Domain-Enumeration-with-PowerView-1a4ee693c4514f48bf9b54688a56aaed)

**Enumerating Permissions of DACLs and SACLs** 

[Access Control List (ACL) Enumeration with PowerView](https://www.notion.so/Access-Control-List-ACL-Enumeration-with-PowerView-c59e7a54b0c342d9a08008e04147b344)

**Enumerating Trusts with PowerView & AD-Module**

[**Trusts Enumeration with PowerView and AD-Module**](https://www.notion.so/Trusts-Enumeration-with-PowerView-and-AD-Module-f5c6e32948ff4998928c7c510b9ebdd5)

**User Hunting with PowerView**

[Find Local domain Admins ](https://www.notion.so/Find-Local-domain-Admins-20937936f81b4ab49356faa12c9de3cb)

# Privilege Escalation & Lateral Movement

- **Privileged Groups**

[Remote Management](https://www.notion.so/Remote-Management-9f17b94c6a194bc991c6942bdaaffc96)

[Escalating Privileges with DNSAdmins Group](https://www.notion.so/Escalating-Privileges-with-DNSAdmins-Group-7e8d519b23464caeac60f4f58b6717c8)

[**SeBackupPrivilege**](https://www.notion.so/SeBackupPrivilege-a2780dc377714530b71f7674ae93f311)

- **ACL Misconfigurations**

[Service Registry¬†ACLs](https://www.notion.so/Service-Registry-ACLs-121aad23baf942058300775a37fae13f)

[WriteOwner, WriteDacl ](https://www.notion.so/WriteOwner-WriteDacl-e08fa8c97fb54462bca3a7729035d06c)

- **Logged Powershell Commands**

[PS Transcripts](https://www.notion.so/PS-Transcripts-8685beab82d84f08b3f26e041effecf2)

- **Impersonation of Privileges**
- üìç**SeImpersonate**
- üìç**SeAssignPrimaryToken**
    
    [Juicy  Potato](https://www.notion.so/Juicy-Potato-37853a8356c64e6da0cedc037e83c8e0)
    

**Misconfigured Services**

- **Unquoted services**
- **Weak Service Registry**
- **Modifiable Binary Path**
    
    [Misconfigures Service ](https://www.notion.so/Misconfigures-Service-53cececd97f24f95852d109bbb7fac85)
    

- **PowerShell Remoting**
    
    [PSRemoting](https://www.notion.so/PSRemoting-75dc8e77503f492eb917afc683f27eb2)
    

- **Disable The Real time Monitoring**
- **Allow Specific File to run - exception**
- **Bypass Constrained Language Mode - AppLocker**
    
    [Bypass Restrictions ](https://www.notion.so/Bypass-Restrictions-2ed81ac369694d499ee2bf64ef32e50c)
    

- **Dumping Credentials - Mimikatz**
    
    [**Dumping Credentials - Mimikatz**](https://www.notion.so/Dumping-Credentials-Mimikatz-f49da00bcc2a48e0b7dc219846652243)
    
- **Pass the hash/ Over Pass the Hash**
    
    [Pass/OverPass-the-Hash](https://www.notion.so/Pass-OverPass-the-Hash-eb4c17fe3ae04d438282e384b693aa3b)
    

- **Service Accounts**
    - **Back Operators**
    - **DNSAdmin**
    - **Account Operators**
    - **Server Operators**
    
- **Kerberos Attacks**
    - **AS-REP Roasting Attack**
    - **Kerberoasting Service Accounts**
        
        [AS-REP Roasting Attack](https://www.notion.so/AS-REP-Roasting-Attack-6f4ab4b4b39d4f4a937c47f5af19fddb)
        
        [Kerberoasting service accounts ](https://www.notion.so/Kerberoasting-service-accounts-53ed72f817ba4f248a4c2e60d1ae70c2)
        
        [DCSync Attack](https://www.notion.so/DCSync-Attack-ebe0fadf8d9d4309bc42cb4f12906c6b)
        

- **Kerberos Delegations:**
    - **Unconstrained**
    - **Constrained**
    - **Resource-based constrained**
    
    [Kerberos Delegation](https://www.notion.so/Kerberos-Delegation-7a50e02ec3db40bebcd0583fd0b2db58)
    

- **Abuse Domain/Forest Trusts:**
    - **Trust Key to forge inter-realm**
    
    [**Domain Trusts - Forging Trust¬†Tickets**  ](https://www.notion.so/Domain-Trusts-Forging-Trust-Tickets-cad847c5afb8447cac284ae5c97ed38e)
    
    [Abuse MSSQL Trusted Links ](https://www.notion.so/Abuse-MSSQL-Trusted-Links-01f5313788dc4007965fdd66fcbec4db)
    

[P[sexec.py](http://psexec.py/) - Impacket](https://www.notion.so/Psexec-py-Impacket-e1706503a54e4e8fa6df71297f689cdb)

[secretsdump - Impacket](https://www.notion.so/secretsdump-Impacket-bd93bb2656944401b604641191f3e056)

# Privilege Escalation to Domain Admins

- **Method #1 Domain user on one of the machines has access to a server where a domain admin is logged in**
    
    [PrivEsca with Domain ](https://www.notion.so/PrivEsca-with-Domain-99f2b5200c9e48c2ade495805ba35493)
    
- **Method #2 Derivative local admin**
    
    [Derivative local admin](https://www.notion.so/Derivative-local-admin-ecf44ed1b3bd4df38e8dbdbca83e14fd)
    

# **Persistence**

- **Golden Ticket**
- **Silver Ticket**
- **Skeleton key**

[Golden Ticket ](https://www.notion.so/Golden-Ticket-741c387f0ed7435ca479f606cc459f82)

[Silver Ticket](https://www.notion.so/Silver-Ticket-8256cc7bf6a24a1597f09aba0d9ae513)

[DCShadow](https://www.notion.so/DCShadow-dc5468d3e5834c9981f0341ead3215bc)

[DSRM](https://www.notion.so/DSRM-6df87d44ef9e4dcaa874e03aa455b454)

[AdminSDHolder](https://www.notion.so/AdminSDHolder-c79c2dced0ad42c2bf4fa42bc8c9f383)

[DCSync](https://www.notion.so/DCSync-dd83eb84be6f43288ddd7f088b94d43b)